#!/bin/bash
set -e
echo "// generated by $0"

# from sort(1): "The locale specified by the environment affects sort order. Set
# LC_ALL=C to get the traditional sort order that uses native byte values."
#
# bash's man page has some locale stuff under "Pathname Expansion" as well. We rely
# on the automagically sorting behaviour of bla/*.png here.
export LC_ALL=C

# produce only one output file at a time so that this can be ran in parallel without races
cd assets
case $1 in
    .c)
        function create_string_array()
        {
            local arrayname=$1
            local countname=$2
            shift 2

            echo "const char *$arrayname[] = {"
            printf '\t"%s",\n' "$@"
            echo '};'
        }
        echo '#include "filelist.h"'
        ;;

    .h)
        function create_string_array()
        {
            local arrayname=$1
            local countname=$2
            shift 2

            echo "extern const char *$arrayname[];"
            echo "#define $countname $#"
        }
        echo '#ifndef FILELIST_H'
        echo '#define FILELIST_H'
        trap "echo '#endif'" exit
        ;;

    *)
        echo "Usage: $0 .c" >&2
        echo "or:    $0 .h" >&2
        exit 2
esac

# variable names written here as they are to make this script more greppable. All
# the things are sorted to make ui consistent and binary searching in sound.c work.
create_string_array filelist_sounds FILELIST_NSOUNDS $(find sounds -name '*.wav' | sort)
create_string_array filelist_players FILELIST_NPLAYERS players/*.png
create_string_array filelist_enemies FILELIST_NENEMIES enemies/*.png
create_string_array filelist_places FILELIST_NPLACES places/*.txt
