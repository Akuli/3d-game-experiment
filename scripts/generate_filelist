#!/bin/bash

set -e

# produce only one output file so that this can be ran in parallel without races
CFILE=/dev/null
HFILE=/dev/null

case "$1" in
    *.c)
        CFILE="$1"
        ;;
    *.h)
        HFILE="$1"
        ;;
    *)
        echo "Usage: $0 FILE" >&2
        exit 2
esac
shift

function create_string_array()
{
    local name=$1
    shift

    echo "extern const char *$name[$#];" >> $HFILE
    echo "const char *$name[$#] = {" >> $CFILE
    printf '\t"%s",\n' "$@" >> $CFILE
    echo '};' >> $CFILE
}

echo "// generated by $0" > $CFILE
echo "// generated by $0" > $HFILE

echo '#include "filelist.h"' >> $CFILE

echo '#ifndef FILELIST_H' >> $HFILE
echo '#define FILELIST_H' >> $HFILE

create_string_array filelist_players players/*.png
create_string_array filelist_sounds $(find sounds -name '*.wav')

echo '#endif    // FILELIST_H' >> $HFILE
