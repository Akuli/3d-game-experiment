#!/bin/bash
set -e

# produce only one output file so that this can be ran in parallel without races
OUT=$1
case $OUT in
    *.c)
        function create_string_array()
        {
            local name=$1
            shift
            echo "const char *$name[$#] = {"
            printf '\t"%s",\n' "$@"
            echo '};'
        }
        START='#include "filelist.h"'
        ;;

    *.h)
        function create_string_array()
        {
            local name=$1
            shift
            echo "extern const char *$name[$#];"
        }
        START=$'#ifndef FILELIST_H\n#define FILELIST_H'
        END='#endif'
        ;;

    *)
        echo "Usage: $0 FILE" >&2
        exit 2
esac

echo "// generated by $0" > $OUT
echo "$START" >> $OUT
create_string_array filelist_players players/*.png >> $OUT
create_string_array filelist_sounds $(find sounds -name '*.wav') >> $OUT
echo "$END" >> $OUT
